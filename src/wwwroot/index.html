<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>Queuesim</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body>
    <div style="width:400px;height:400px;margin:auto;">
        <button style="float:left;" onclick="drawChart()">Run sim</button>
        <canvas id="myChart"></canvas>
    </div>

    <script>
        async function drawChart() {
            const ctx = document.getElementById('myChart');
            const jsonResponse = await (await fetch('/sim')).json();
            const queueDepths = jsonResponse.queueDepths;
            const running = jsonResponse.running;
            const labels = queueDepths.map((x, i) => i);
            const data = {
                labels: labels,
                datasets: [{
                    label: 'Queue Depth',
                    data: queueDepths,
                    fill: false,
                    borderColor: 'rgb(75, 192, 192)',
                },
                {
                    label: 'Running',
                    data: running,
                    fill: false,
                    borderColor: 'rgb(192, 75, 75)',
                }]
            };

            new Chart(ctx, {
                type: 'line',
                data: data,
                options: {
                    scales: {
                        x: {
                            text: 'Timestamp (min)'
                        },
                        y: {
                            text: 'Items in Queue'
                        }
                    }
                }
            });
        }
    </script>
</body>

</html>